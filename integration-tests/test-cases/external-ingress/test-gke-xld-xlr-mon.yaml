xl_mode: up
expect:
  assertion:
    generated_files:
      - file_name: xebialabs/kubernetes/xl-release/external-db/active-active/xlr-deployment-active.yaml
        has_elements:
          '[2]spec.template.spec.initContainers[0].image': 'alpine:3.6'
          '[2]spec.template.spec.initContainers[1].image': 'xebialabs/tiny-tools'
          '[2]spec.template.spec.containers[0].image': 'xebialabs/xl-release:{{XLR_OFFICIAL_VERSION}}'
      - file_name: xebialabs/kubernetes/xl-k8s-foundation/rabbitmq/xl-rabbitmq.yaml
        has_elements:
          '[1]spec.template.spec.containers[0].image': 'rabbitmq:3.8.0-management'
      - file_name: xebialabs/kubernetes/xl-k8s-foundation/postgresql/xl-postgresql.yaml
        has_elements:
          '[1]spec.template.spec.initContainers[0].image': 'busybox'
          '[1]spec.template.spec.initContainers[1].image': 'busybox:1.26.2'
          '[1]spec.template.spec.containers[0].image': 'postgres:10.5'
      - file_name: xebialabs/kubernetes/xl-k8s-foundation/nfs-client-provisioner/deployment.yaml
        has_elements:
          'spec.template.spec.containers[0].image': 'quay.io/external_storage/nfs-client-provisioner:latest'
      - file_name: xebialabs/kubernetes/xl-deploy/external-db/active-active/xld-deployment-master.yaml
        has_elements:
          '[3]spec.template.spec.initContainers[0].image': 'busybox'
          '[3]spec.template.spec.initContainers[1].image': 'alpine:3.6'
          '[3]spec.template.spec.initContainers[2].image': 'xebialabs/tiny-tools'
          '[3]spec.template.spec.containers[0].image': 'xebialabs/xl-deploy:{{XLD_OFFICIAL_VERSION}}'
      - file_name: xebialabs/kubernetes/xl-deploy/external-db/active-active/xld-deployment-worker.yaml
        has_elements:
          '[1]spec.template.spec.initContainers[0].image': 'busybox'
          '[1]spec.template.spec.initContainers[1].image': 'alpine:3.6'
          '[1]spec.template.spec.containers[0].image': 'xebialabs/xl-deploy:{{XLD_OFFICIAL_VERSION}}'
      - file_name: xebialabs/kubernetes/pg-stack/grafana/deployment.yaml
        has_elements:
          '[0]spec.template.spec.initContainers[0].image': 'busybox'
          '[0]spec.template.spec.containers[0].image': 'grafana/grafana:5.4.4'
      - file_name: xebialabs/kubernetes/pg-stack/grafana/importer-job.yaml
        has_elements:
          'spec.template.spec.initContainers[0].image': 'xebialabs/tiny-tools'
          'spec.template.spec.containers[0].image': 'giantswarm/tiny-tools'
      - file_name: xebialabs/kubernetes/pg-stack/kube-state-metrics/kube-state-metrics-deployment.yaml
        has_elements:
          'spec.template.spec.containers[0].image': 'quay.io/coreos/kube-state-metrics:v1.5.0'
          'spec.template.spec.containers[1].image': 'k8s.gcr.io/addon-resizer:1.8.3'
      - file_name: xebialabs/kubernetes/pg-stack/prometheus/deployment.yaml
        has_elements:
          'spec.template.spec.initContainers[0].image': 'busybox:latest'
          'spec.template.spec.containers[0].image': 'prom/prometheus:v2.7.2'
      - file_name: xebialabs/kubernetes/efk-stack/elasticsearch/deployment.yaml
        has_elements:
          '[0]spec.template.spec.initContainers[0].image': 'alpine:3.6'
          '[0]spec.template.spec.initContainers[1].image': 'busybox'
          '[0]spec.template.spec.containers[0].image': 'docker.elastic.co/elasticsearch/elasticsearch-oss:6.5.0'
      - file_name: xebialabs/kubernetes/efk-stack/es-curator/cronjob.yaml
        has_elements:
          'spec.jobTemplate.spec.template.spec.containers[0].image': 'xebialabsunsupported/xl-es-curator'
      - file_name: xebialabs/kubernetes/efk-stack/fluentd/daemonset.yaml
        has_elements:
          'spec.template.spec.containers[0].image': 'k8s.gcr.io/fluentd-elasticsearch:v2.3.2'
      - file_name: xebialabs/kubernetes/efk-stack/kibana/deployment.yaml
        has_elements:
          '[0]spec.template.spec.initContainers[0].image': 'busybox:1'
          '[0]spec.template.spec.containers[0].image': 'docker.elastic.co/kibana/kibana-oss:6.5.0'
      - file_name: xebialabs/kubernetes/efk-stack/kibana/dashboard-job.yaml
        has_elements:
          'spec.template.spec.initContainers[0].image': 'busybox:1'
          'spec.template.spec.initContainers[1].image': 'busybox:1'
          'spec.template.spec.containers[0].image': 'xebialabs/kibana-dashboard:1.0.0'
      - file_name: xebialabs/kubernetes/xl-k8s-foundation/xl-pvc/pvc-xld-export.yaml
        has_elements:
          'metadata.annotations.volume\.beta\.kubernetes\.io/storage-class': 'xebialabs-managed-nfs-storage'
      - file_name: xebialabs/kubernetes/xl-k8s-foundation/xl-pvc/pvc-xlr-reports.yaml
        has_elements:
          'metadata.annotations.volume\.beta\.kubernetes\.io/storage-class': 'xebialabs-managed-nfs-storage'
      - file_name: xebialabs/kubernetes/xl-k8s-foundation/rabbitmq/xl-rabbitmq.yaml
        has_elements:
          '[1]spec.volumeClaimTemplates[0].spec.storageClassName': 'xebialabs-standard-retain'
      - file_name: xebialabs/kubernetes/xl-k8s-foundation/postgresql/xl-postgresql.yaml
        has_elements:
          '[1]spec.volumeClaimTemplates[0].spec.storageClassName': 'xebialabs-standard-retain'
      - file_name: xebialabs/kubernetes/xl-deploy/external-db/active-active/xld-deployment-worker.yaml
        has_elements:
          '[1]spec.volumeClaimTemplates[0].spec.storageClassName': 'xebialabs-standard-retain'
      - file_name: xebialabs/kubernetes/pg-stack/prometheus/deployment.yaml
        has_elements:
          '[0]spec.volumeClaimTemplates[0].spec.storageClassName': 'xebialabs-standard-retain'
      - file_name: xebialabs/kubernetes/pg-stack/grafana/pvc.yaml
        has_elements:
          'spec.storageClassName': 'xebialabs-standard-retain'
      - file_name: xebialabs/kubernetes/efk-stack/elasticsearch/deployment.yaml
        has_elements:
          '[0]spec.volumeClaimTemplates[0].spec.storageClassName': 'xebialabs-standard-retain'
    secrets:
      XlKeyStorePass: test123
      XldAdminPass: password
      XldDbPass: xl-deploy
      XlrAdminPass: password
      XlrDbPass: xl-release
      XlrReportDbPass: xl-release-report
      GrafanaUserPass: test123
    values:
      GrafanaUser: user
      InstallXLD: true
      InstallXLR: true
      MonitoringInstall: true
      PostgresEffectCacheSize: 2GB
      PostgresMaxConn: 400
      PostgresMaxWallSize: 512MB
      PostgresSharedBuff: 612MB
      PostgresSyncCommit: 'off'
      XldDbName: xl-deploy
      XldDbUser: xl-deploy
      XldOfficialVersion: 9.5.1
      XlrDbName: xl-release
      XlrDbUser: xl-release
      XlrOfficialVersion: 9.5.2
      XlrReportDbName: xl-release-report
      XlrReportDbUser: xl-release-report
  to_exist:
  - xebialabs/xl-deploy.yaml
  - xebialabs/xl-release.yaml
  - xebialabs/kubernetes/xl-k8s-foundation/postgresql/xl-postgresql.yaml
  - xebialabs/kubernetes/xl-k8s-foundation/xl-pvc/pvc-xld-export.yaml

  - xebialabs/kubernetes/xl-deploy/external-db/active-active/xld-deployment-master.yaml
  - xebialabs/kubernetes/xl-deploy/external-db/active-active/xld-deployment-worker.yaml
  - xebialabs/kubernetes/xl-release/external-db/active-active/xlr-deployment-active.yaml
  - xebialabs/kubernetes/xl-k8s-foundation/xl-pvc/pvc-xlr-reports.yaml
  - xebialabs/kubernetes/efk-stack/elasticsearch/rbac.yaml
  - xebialabs/kubernetes/efk-stack/elasticsearch/deployment.yaml
  - xebialabs/kubernetes/efk-stack/fluentd/configmap.yaml
  - xebialabs/kubernetes/efk-stack/fluentd/daemonset.yaml
  - xebialabs/kubernetes/efk-stack/fluentd/rbac.yaml
  - xebialabs/kubernetes/efk-stack/kibana/deployment.yaml
  - xebialabs/kubernetes/efk-stack/kibana/dashboard-job.yaml
  - xebialabs/kubernetes/efk-stack/es-curator/cronjob.yaml
  - xebialabs/kubernetes/efk-stack/es-curator/configmap.yaml
  - xebialabs/kubernetes/pg-stack/prometheus/rbac.yaml
  - xebialabs/kubernetes/pg-stack/prometheus/configmap.yaml
  - xebialabs/kubernetes/pg-stack/prometheus/deployment.yaml
  - xebialabs/kubernetes/pg-stack/grafana/configmap.yaml
  - xebialabs/kubernetes/pg-stack/grafana/secret.yaml
  - xebialabs/kubernetes/pg-stack/grafana/deployment.yaml
  - xebialabs/kubernetes/pg-stack/grafana/importer-job.yaml
  - xebialabs/kubernetes/pg-stack/grafana/pvc.yaml
  - xebialabs/kubernetes/pg-stack/kube-state-metrics/kube-state-metrics-cluster-role.yaml
  - xebialabs/kubernetes/pg-stack/kube-state-metrics/kube-state-metrics-cluster-role-binding.yaml
  - xebialabs/kubernetes/pg-stack/kube-state-metrics/kube-state-metrics-deployment.yaml
  - xebialabs/kubernetes/pg-stack/kube-state-metrics/kube-state-metrics-role.yaml
  - xebialabs/kubernetes/pg-stack/kube-state-metrics/kube-state-metrics-role-binding.yaml
  - xebialabs/kubernetes/pg-stack/kube-state-metrics/kube-state-metrics-service.yaml
  - xebialabs/kubernetes/pg-stack/kube-state-metrics/kube-state-metrics-service-account.yaml
  to_not_exist:
  - xebialabs/kubernetes/xl-deploy/local-db/xld-deployment-single-node.yaml
  - xebialabs/kubernetes/xl-release/local-db/xlr-deployment-single-node.yaml
  - xebialabs/kubernetes/xl-k8s-foundation/rabbitmq/ingress.yaml
  - xebialabs/kubernetes/efk-stack/kibana/ingress.yaml
  - xebialabs/kubernetes/pg-stack/grafana/ingress.yaml
  - xebialabs/kubernetes/xl-k8s-foundation/ha-proxy-ingress-controller/default-backend.yaml
  - xebialabs/kubernetes/xl-k8s-foundation/ha-proxy-ingress-controller/service-l7.yaml
  - xebialabs/kubernetes/xl-k8s-foundation/ha-proxy-ingress-controller/ingress-controller.yaml
with_answers:
  K8sApiServerURL: https://k8s.com:6443
  K8sAuthentication: Token
  K8sSetup: GoogleGKE
  K8sToken: eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJ4ZWJpYWxhYnMtYWRtaW4tdG9rZW4tZmpsNWgiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoieGViaWFsYWJzLWFkbWluIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiMDMyMGViYjItYTg5OS0xMWU5LTljZTgtNDIwMTBhODQwMWQ3Iiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmUtc3lzdGVtOnhlYmlhbGFicy1hZG1pbiJ9.AVK402uvVe-TUdSIb7f_gYtcSm7rei66Inm4TlVxMfeU6G3-gDOEtPRQ-NHUHBQyt6juHaRX2xfT7cLRoBWZl38pVnJJf3oMAJBdnkcpycjAGOaI_rU_xUs0RasPs8yUAFTD3RZ9DdnOhw4MBWWWDcMMqsEWhJPLGrpEnEu5_Mgeta-BkTqioqzJBr2LnkGpiv-ha-6hgO7L2_v8bSGrRVA_xc2SQXY4wtkjkK3a1CzQ_xxBz396OwDVpMwI5lRm4xRCkiUrk46xuxWMGM483V49Hep4yFIkShhNqaKI6L6uw4sUX9Dp7mftXRYotTbGd_hhJlmQTWjjIb_qPqt-Iw
  NfsServerHost: 12.2.2.2
  NfsSharePath: /xebialabs
  UseInternalLoadBalancer: false
  UseKubeconfig: false
  UseCustomNamespace: false
  IsHybridCluster: true
  UseExistingStorageClasses: false
  InstallXLD: true
  InstallXLR: true
  MonitoringInstall: true
  MonitoringUser: mon-user
  MonitoringUserPass: mon-pass
  PostgresEffectCacheSize: 2GB
  PostgresMaxConn: 400
  PostgresMaxWallSize: 512MB
  PostgresSharedBuff: 612MB
  PostgresSyncCommit: 'off'
  XlKeyStore: ../integration-tests/files/test-file
  XlKeyStorePass: test123
  XldAdminPass: password
  XldDbName: xl-deploy
  XldDbPass: xl-deploy
  XldDbUser: xl-deploy
  XldLic: ../integration-tests/files/test-file
  XldOfficialVersion: 9.5.1
  XlrAdminPass: password
  XlrDbName: xl-release
  XlrDbPass: xl-release
  XlrDbUser: xl-release
  XlrLic: ../integration-tests/files/test-file
  XlrOfficialVersion: 9.5.2
  XlrReportDbName: xl-release-report
  XlrReportDbPass: xl-release-report
  XlrReportDbUser: xl-release-report
  UseExternalIngress: true
  GrafanaUserPass: test123
  GrafanaUser: user
