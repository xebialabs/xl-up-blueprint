apiVersion: xl-deploy/v1
kind: Applications
spec:
- directory: Applications/XEBIALABS
  children:
  - directory: XL-RELEASE
    children:
{{if (or ( eq .K8sSetup "AWS EKS" ) ( eq .K8sSetup "Plain multinode K8s cluster" ))}}
    - directory: EXTERNAL-DB
      children:
      - directory: ACTIVE-ACTIVE
        children:
        - name: XL-Release-Active-Active
          type: udm.Application
          children:
          - name: !value xlVersion
            orchestrator:
              - sequential-by-dependency
            type: udm.DeploymentPackage
            deployables:
            - name: xlr-deployment
              type: k8s.ResourcesFile
              file: !file ../kubernetes/xl-release/external-db/active-active/xlr-deployment-active.yaml
            applicationDependencies:
              {{if  .InstallXLD }}
              XL-Deploy-Hot-Standby: !value xlVersion
              {{end}}
              {{if  not .InstallXLD}}
                {{if  not .InstallMonitoring}}
              K8s-Ingress-Controller: !value xlVersion
                {{else}}
              Grafana-Dashboard: !value xlVersion
              Kibana: !value xlVersion
                {{end}}
              {{end}}
            undeployDependencies: "true"
{{end}}
  {{if  eq .K8sSetup "Local K8s from Docker Desktop for Mac/Windows" }}
    - directory: LOCAL-DB
      children:
      - name: XL-Release-Sinlge-Node
        type: udm.Application
        children:
        - name: !value xlVersion
          orchestrator:
            - sequential-by-dependency
          type: udm.DeploymentPackage
          deployables:
          - name: xlr-deployment
            type: k8s.ResourcesFile
            file: !file ../kubernetes/xl-release/local-db/xlr-deployment-single-node.yaml
          applicationDependencies:
            {{if  .InstallXLD }}
            XL-Deploy-Single-Node: !value xlVersion
            {{end}}
            {{if  not .InstallXLD}}
            K8s-Ingress-Controller: !value xlVersion
            PostgreSQL: !value xlVersion
            {{end}}
          undeployDependencies: "true"
  {{end}}